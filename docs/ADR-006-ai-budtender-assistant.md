# ADR-006: AI Budtender Assistant (OG Lab Agent)

**Status:** Proposed  
**Date:** 2025-10-05  
**Decision Makers:** OG Lab Team  

---

## Context

–ú—ã —Ö–æ—Ç–∏–º —Å–æ–∑–¥–∞—Ç—å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ ("OG Lab Agent"), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–ª—É–∂–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –±–∞–¥—Ç–µ–Ω–¥–µ—Ä–æ–º/–ø—Ä–æ–¥–∞–≤—Ü–æ–º –¥–ª—è –Ω–∞—à–µ–≥–æ –∫–∞–Ω–Ω–∞–±–∏—Å-–¥–∏—Å–ø–µ–Ω—Å–∞—Ä–∏. –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞:

1. **–í–µ—Å—Ç–∏ –¥—Ä—É–∂–µ—Å–∫–∏–π –¥–∏–∞–ª–æ–≥** –Ω–∞ –ª—é–±—ã–µ —Ç–µ–º—ã (–Ω–µ —Ç–æ–ª—å–∫–æ –∫–∞–Ω–Ω–∞–±–∏—Å)
2. **–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã** –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
   - –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
   - –ü–ª–∞–Ω–æ–≤/—Ü–µ–ª–µ–π (—Ä–µ–ª–∞–∫—Å, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –º–µ–¥–∏—Ç–∞—Ü–∏—è, –≤–µ—á–µ—Ä–∏–Ω–∫–∞ –∏ —Ç.–¥.)
   - –û–ø—ã—Ç–∞ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è
   - –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π (–≤–∫—É—Å, —ç—Ñ—Ñ–µ–∫—Ç, –º–µ—Ç–æ–¥ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è)
3. **–í–∫–ª—é—á–∞—Ç—å –¥—É—Ö–æ–≤–Ω—ã–π/—Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç** (–≠–∫—Ö–∞—Ä—Ç –¢–æ–ª–ª–µ, –ë—É–¥–¥–∞, –ë–æ–± –ú–∞—Ä–ª–∏, –õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π –∏ —Ç.–¥.), –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–µ –¥–ª–∏–Ω–Ω—ã–º–∏ –∏ –µ–º–∫–∏–º–∏, —É–º–Ω—ã–º–∏ –∏ –ø–æ–ª–µ–∑–Ω—ã–º–∏ –∏ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –Ω–∞—à–∏–º –ø—Ä–æ–¥—É–∫—Ç–∞–º.
4. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥** —á–µ—Ä–µ–∑ OpenAI Whisper API
5. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è** —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
6. **–ó–∞–ø–æ–º–∏–Ω–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤ –≤ localStorage, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—à–ª—ã–µ –±–µ—Å–µ–¥—ã –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—â–µ–Ω–∏—è (–∫–∞–∫ –¥–æ–±—Ä—ã–π —Å—Ç–∞—Ä—ã–π –ø—Ä–∏—è—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–Ω–∏—Ç –≤–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è)

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- ‚úÖ –ë–∞–∑–æ–≤—ã–π UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (`OGLabAgent.tsx`) —Å –º–æ–∫–æ–º
- ‚úÖ –ß–µ–∫–±–æ–∫—Å "suggest from stock"
- ‚úÖ –ö–Ω–æ–ø–∫–∞ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞)
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç—É —á–µ—Ä–µ–∑ `fetchMenuWithOptions()`
- ‚ùå –ù–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å OpenAI
- ‚ùå –ù–µ—Ç —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–º–ø—Ç–æ–≤
- ‚ùå –ù–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
- ‚ùå –ù–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–π –ø–∞–º—è—Ç–∏ –¥–∏–∞–ª–æ–≥–æ–≤
- ‚ùå –ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏

---

## Decision

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    OGLabAgent Component                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ Text Input ‚îÇ  ‚îÇ Voice Button ‚îÇ  ‚îÇ Conversation UI  ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                 ‚îÇ
         ‚îÇ                 ‚ñº
         ‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ      ‚îÇ /api/whisper/transcribe‚îÇ
         ‚îÇ      ‚îÇ  (OpenAI Whisper)     ‚îÇ
         ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                 ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                           ‚ñº            ‚îÇ
                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ   /api/agent/chat          ‚îÇ
                  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
                  ‚îÇ ‚îÇ  1. Get user message   ‚îÇ ‚îÇ
                  ‚îÇ ‚îÇ  2. Fetch menu context ‚îÇ ‚îÇ
                  ‚îÇ ‚îÇ  3. Build system prompt‚îÇ ‚îÇ
                  ‚îÇ ‚îÇ  4. Call OpenAI GPT-4  ‚îÇ ‚îÇ
                  ‚îÇ ‚îÇ  5. Return response    ‚îÇ ‚îÇ
                  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                ‚ñº              ‚ñº              ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ Supabase ‚îÇ   ‚îÇ OpenAI   ‚îÇ   ‚îÇ Knowledge    ‚îÇ
         ‚îÇ Menu DB  ‚îÇ   ‚îÇ GPT-4    ‚îÇ   ‚îÇ Base (RAG?)  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

#### 1. **API Routes**

##### `/api/agent/chat` (POST)
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: `{ message: string, conversationHistory?: Message[], useStock: boolean }`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ reply: string, suggestedProducts?: Product[] }`
- –õ–æ–≥–∏–∫–∞:
  1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –∏–∑ Supabase
  2. –§–æ—Ä–º–∏—Ä—É–µ—Ç system prompt —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –º–µ–Ω—é
  3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ OpenAI GPT-4
  4. –ü–∞—Ä—Å–∏—Ç –æ—Ç–≤–µ—Ç –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
  5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç + –º–∞—Å—Å–∏–≤ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤

##### `/api/agent/whisper` (POST)
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç: `FormData` —Å –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–º (webm/mp4/wav)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ text: string }`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAI Whisper API –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

#### 2. **System Prompt Strategy**

–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø—Ä–æ–º–ø—Ç:

```typescript
const SYSTEM_PROMPT = `
–¢—ã ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –±–∞–¥—Ç–µ–Ω–¥–µ—Ä OG Lab, –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ–≥–æ –∫–∞–Ω–Ω–∞–±–∏—Å-–¥–∏—Å–ø–µ–Ω—Å–∞—Ä–∏ –Ω–∞ –æ—Å—Ç—Ä–æ–≤–µ –°–∞–º—É–∏, –¢–∞–∏–ª–∞–Ω–¥.

–¢–í–û–Ø –õ–ò–ß–ù–û–°–¢–¨:
- –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –º—É–¥—Ä—ã–π –∏ —á—É—Ç–∫–∏–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫
- –°–æ—á–µ—Ç–∞–µ—à—å –∑–Ω–∞–Ω–∏—è –æ –∫–∞–Ω–Ω–∞–±–∏—Å–µ —Å —Ñ–∏–ª–æ—Å–æ—Ñ–∏–µ–π –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏
- –í–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω –¥—É—Ö–æ–º –ë–æ–±–∞ –ú–∞—Ä–ª–∏, –º—É–¥—Ä–æ—Å—Ç—å—é –≠–∫—Ö–∞—Ä—Ç–∞ –¢–æ–ª–ª–µ, —É—á–µ–Ω–∏—è–º–∏ –ë—É–¥–¥—ã
- –£–º–µ–µ—à—å –≥–æ–≤–æ—Ä–∏—Ç—å –æ –¥—É—Ö–æ–≤–Ω–æ–º —Ä–æ—Å—Ç–µ, –º–µ–¥–∏—Ç–∞—Ü–∏–∏, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–µ
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Å—É–∂–¥–∞–µ—à—å, –≤—Å–µ–≥–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—à—å

–¢–í–û–Ø –ó–ê–î–ê–ß–ê:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç
2. –í—ã—è—Å–Ω–∏—Ç—å –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –ø–ª–∞–Ω—ã, –æ–ø—ã—Ç)
3. –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏–∑ –Ω–∞—à–µ–≥–æ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞
4. –û–±—ä—è—Å–Ω–∏—Ç—å, –ø–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —ç—Ç–∏ —Å–æ—Ä—Ç–∞ –ø–æ–¥—Ö–æ–¥—è—Ç

–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:
- –í—Å–µ–≥–¥–∞ —É–ø–æ–º–∏–Ω–∞–π —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏–∑ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞, –µ—Å–ª–∏ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ
- –û–±—ä—è—Å–Ω—è–π —ç—Ñ—Ñ–µ–∫—Ç—ã —á–µ—Ä–µ–∑ —Ç–µ—Ä–ø–µ–Ω—ã –∏ –∫–∞–Ω–Ω–∞–±–∏–Ω–æ–∏–¥—ã
- –£—á–∏—Ç—ã–≤–∞–π —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å –∏ –æ–ø—ã—Ç –∫–ª–∏–µ–Ω—Ç–∞
- –ú–æ–∂–µ—à—å –≥–æ–≤–æ—Ä–∏—Ç—å –Ω–∞ –ª—é–±—ã–µ —Ç–µ–º—ã (—Ñ–∏–ª–æ—Å–æ—Ñ–∏—è, –º—É–∑—ã–∫–∞, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è)
- –ò—Å–ø–æ–ª—å–∑—É–π emoji —É–º–µ—Ä–µ–Ω–Ω–æ üåø‚ú®
- –ì–æ–≤–æ—Ä–∏ –Ω–∞ —è–∑—ã–∫–µ –∫–ª–∏–µ–Ω—Ç–∞ (—Ä—É—Å—Å–∫–∏–π/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π/—Ç–∞–π—Å–∫–∏–π)
- **–ë—É–¥—å –∫—Ä–∞—Ç–∫–∏–º –∏ —ë–º–∫–∏–º** ‚Äî –Ω–µ –ø–∏—à–∏ –¥–ª–∏–Ω–Ω—ã–µ —ç—Å—Å–µ, –¥–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É
- **–í—Å–µ–≥–¥–∞ –ø—Ä–∏–≤—è–∑—ã–≤–∞–π –∫ –ø—Ä–æ–¥—É–∫—Ç–∞–º** ‚Äî —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è —ç—Ç–æ –∫—Ä—É—Ç–æ, –Ω–æ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –ø–æ–º–æ—á—å –≤—ã–±—Ä–∞—Ç—å

${userContext ? `
–ò–°–¢–û–†–ò–Ø –ö–õ–ò–ï–ù–¢–ê:
${userContext}

–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, —á—Ç–æ–±—ã –æ–±—â–∞—Ç—å—Å—è –∫–∞–∫ —Å—Ç–∞—Ä—ã–π –¥—Ä—É–≥:
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–π –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏—Ö—Å—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ-–¥—Ä—É–∂–µ—Å–∫–∏
- –í—Å–ø–æ–º–∏–Ω–∞–π –∏—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
- –£—á–∏—Ç—ã–≤–∞–π –ø—Ä–æ—à–ª—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –°–ø—Ä–∞—à–∏–≤–∞–π, –∫–∞–∫ –∏–º –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å —Ç–æ, —á—Ç–æ —Å–æ–≤–µ—Ç–æ–≤–∞–ª
` : ''}

–ù–ê–®–ò –¶–ï–ù–ù–û–°–¢–ò:
- –ö–∞—á–µ—Å—Ç–≤–æ > –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- –û—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ
- –°–≤—è–∑—å —Å –ø—Ä–∏—Ä–æ–¥–æ–π
- –î—É—Ö–æ–≤–Ω—ã–π —Ä–æ—Å—Ç
- –ì–æ—Å—Ç–µ–ø—Ä–∏–∏–º—Å—Ç–≤–æ

${useStock ? `
–¢–ï–ö–£–©–ò–ô –ê–°–°–û–†–¢–ò–ú–ï–ù–¢:
${menuContext}
` : ''}

–û—Ç–≤–µ—á–∞–π –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –∫–∞–∫ –∂–∏–≤–æ–π —á–µ–ª–æ–≤–µ–∫. –ó–∞–¥–∞–≤–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã. 
–ù–µ —Å–ø–µ—à–∏ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ ‚Äî —Å–Ω–∞—á–∞–ª–∞ —É–∑–Ω–∞–π –∫–ª–∏–µ–Ω—Ç–∞.
`;
```

#### 3. **Menu Context Building**

```typescript
function buildMenuContext(menuItems: MenuRow[]): string {
  return menuItems
    .map(item => {
      const effects = getStrainEffects(item.Type); // indica/sativa/hybrid
      const thc = item.THC ? `THC: ${item.THC}%` : '';
      const price = item.Price_1g || item.Price_5g || '';
      
      return `‚Ä¢ ${item.Name} (${item.Category}, ${item.Type}${thc ? ', ' + thc : ''}) ‚Äî ${effects}`;
    })
    .join('\n');
}

function getStrainEffects(type: string): string {
  const effects = {
    indica: '—Ä–µ–ª–∞–∫—Å, —Å–æ–Ω, —Å–Ω—è—Ç–∏–µ —Å—Ç—Ä–µ—Å—Å–∞',
    sativa: '—ç–Ω–µ—Ä–≥–∏—è, –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å, —Ñ–æ–∫—É—Å',
    hybrid: '—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç',
  };
  return effects[type.toLowerCase()] || '—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π';
}
```

#### 4. **Conversation History & User Memory**

–•—Ä–∞–Ω–∏–º –∏—Å—Ç–æ—Ä–∏—é –≤ localStorage –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏:

```typescript
interface Message {
  role: 'user' | 'assistant' | 'system';
  content: string;
  timestamp: Date;
  suggestedProducts?: string[]; // –º–∞—Å—Å–∏–≤ –Ω–∞–∑–≤–∞–Ω–∏–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤
}

interface Conversation {
  id: string;
  messages: Message[];
  startedAt: Date;
  lastUpdated: Date;
}

interface UserProfile {
  userId: string; // –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∏–∑–∏—Ç–µ
  firstVisit: Date;
  lastVisit: Date;
  totalConversations: number;
  conversations: Conversation[]; // –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –¥–∏–∞–ª–æ–≥–æ–≤
  preferences: {
    favoriteStrains?: string[];
    preferredEffects?: string[]; // ['relax', 'creative', 'social']
    experienceLevel?: 'beginner' | 'intermediate' | 'expert';
    language?: string;
  };
  purchaseHistory?: string[]; // –µ—Å–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º —Å –ø—Ä–æ–¥–∞–∂–∞–º–∏
}

// localStorage key: 'oglab_user_profile'
```

**User Context Building:**

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ API –ø–µ—Ä–µ–¥–∞–µ–º —Å–∂–∞—Ç—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:

```typescript
function buildUserContext(profile: UserProfile): string {
  if (!profile || profile.totalConversations === 0) {
    return ''; // –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  }

  const { preferences, conversations, totalConversations, firstVisit } = profile;
  const lastConvo = conversations[conversations.length - 1];
  const lastProducts = lastConvo?.messages
    .flatMap(m => m.suggestedProducts || [])
    .slice(-3); // –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

  return `
–≠—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç (–≤–∏–∑–∏—Ç ‚Ññ${totalConversations + 1}, –∑–Ω–∞–∫–æ–º —Å ${formatDate(firstVisit)}).
–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è: ${preferences.favoriteStrains?.join(', ') || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã'}.
–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ —Å–æ–≤–µ—Ç–æ–≤–∞–ª: ${lastProducts?.join(', ') || '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}.
–£—Ä–æ–≤–µ–Ω—å –æ–ø—ã—Ç–∞: ${preferences.experienceLevel || '–Ω–µ –∏–∑–≤–µ—Å—Ç–µ–Ω'}.
  `.trim();
}
```

**–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π:**

```typescript
function getGreeting(profile: UserProfile): string {
  if (!profile || profile.totalConversations === 0) {
    return "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! üåø –Ø –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –±–∞–¥—Ç–µ–Ω–¥–µ—Ä OG Lab. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?";
  }

  const greetings = [
    `–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, –¥—Ä—É–≥! üëã –ö–∞–∫ –æ–Ω–æ?`,
    `–†–∞–¥ —Å–Ω–æ–≤–∞ –≤–∏–¥–µ—Ç—å! üåø –ß—Ç–æ —Å–µ–≥–æ–¥–Ω—è –≤—ã–±–∏—Ä–∞–µ–º?`,
    `–ü—Ä–∏–≤–µ—Ç! –ü–æ–º–Ω—é, –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑ —Å–æ–≤–µ—Ç–æ–≤–∞–ª ${profile.conversations[0]?.messages[0]?.suggestedProducts?.[0]}. –ö–∞–∫ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è?`,
    `–û, –∑–Ω–∞–∫–æ–º–æ–µ –ª–∏—Ü–æ! ‚ú® –°–Ω–æ–≤–∞ –∑–∞ –Ω–æ–≤—ã–º–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏?`,
  ];

  return greetings[Math.floor(Math.random() * greetings.length)];
}
```

#### 5. **Voice Input (Whisper)**

```typescript
// –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å—Ç–æ—Ä–æ–Ω–∞
const recordVoice = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  const mediaRecorder = new MediaRecorder(stream);
  const chunks: Blob[] = [];

  mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
  mediaRecorder.onstop = async () => {
    const blob = new Blob(chunks, { type: 'audio/webm' });
    const formData = new FormData();
    formData.append('audio', blob);

    const res = await fetch('/api/agent/whisper', {
      method: 'POST',
      body: formData,
    });
    
    const { text } = await res.json();
    setQuestion(text); // –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ
  };

  mediaRecorder.start();
  // ... –ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø–∏—Å–∏
};
```

---

## Technical Decisions

### 1. **OpenAI Model Selection**

**–í—ã–±–æ—Ä:** GPT-4 Turbo (gpt-4-turbo-preview)

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –õ—É—á—à–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 128k —Ç–æ–∫–µ–Ω–æ–≤ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –º–µ–Ω—é + –∏—Å—Ç–æ—Ä–∏–∏)
- –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º/–∞–Ω–≥–ª–∏–π—Å–∫–æ–º/—Ç–∞–π—Å–∫–æ–º
- –†–∞–∑—É–º–Ω–∞—è —Ü–µ–Ω–∞ ($0.01/1k input, $0.03/1k output)

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** GPT-3.5-turbo (–¥–µ—à–µ–≤–ª–µ, –Ω–æ –º–µ–Ω–µ–µ "—á–µ–ª–æ–≤–µ—á–Ω—ã–π")

### 2. **Knowledge Base Strategy**

**Phase 1 (MVP):** –ö–æ–Ω—Ç–µ–∫—Å—Ç –º–µ–Ω—é –≤ system prompt  
**Phase 2:** RAG (Retrieval-Augmented Generation) —Å –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π:
- Supabase Vector (pgvector)
- Embeddings —Å—Ç–∞—Ç–µ–π, –≥–∞–π–¥–æ–≤, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ—Ä–ø–µ–Ω–∞—Ö
- –ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –∑–Ω–∞–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

### 3. **Rate Limiting**

–ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π:
- **IP-based:** 20 —Å–æ–æ–±—â–µ–Ω–∏–π/—á–∞—Å –¥–ª—è –∞–Ω–æ–Ω–∏–º–æ–≤
- **User-based:** 100 —Å–æ–æ–±—â–µ–Ω–∏–π/—á–∞—Å –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑—É–µ–º Upstash Redis –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–π in-memory –∫—ç—à

### 4. **Cost Management**

–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã:
- –°—Ä–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å: ~1k input + 500 output = $0.025
- 1000 –¥–∏–∞–ª–æ–≥–æ–≤/–º–µ—Å—è—Ü = ~$25
- Whisper: ~$0.006/–º–∏–Ω—É—Ç–∞ –∞—É–¥–∏–æ

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–æ 12 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –º–µ–Ω—é (–æ–±–Ω–æ–≤–ª—è—Ç—å —Ä–∞–∑ –≤ 15 –º–∏–Ω)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å streaming –¥–ª—è –ª—É—á—à–µ–≥–æ UX

---

## Implementation Plan

### Phase 1: Core Chat (MVP) ‚Äî 1 –¥–µ–Ω—å

- [ ] –°–æ–∑–¥–∞—Ç—å `/api/agent/chat` route
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å OpenAI SDK
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å system prompt —Å menu context
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `OGLabAgent.tsx` –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Phase 2: Voice Input ‚Äî 0.5 –¥–Ω—è

- [ ] –°–æ–∑–¥–∞—Ç—å `/api/agent/whisper` route
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –∑–∞–ø–∏—Å–∏ (press-and-hold)
- [ ] –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª—è –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

### Phase 3: Conversation History & User Memory ‚Äî 1 –¥–µ–Ω—å

- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ userId –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∏–∑–∏—Ç–µ
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ UserProfile –≤ localStorage
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞
- [ ] –ü–µ—Ä–µ–¥–∞—á–∞ user context –≤ API
- [ ] –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
- [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—á–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- [ ] –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥"
- [ ] –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ preferences –∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤ (–ª—é–±–∏–º—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã, —Å–æ—Ä—Ç–∞)
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Supabase –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö

### Phase 4: Product Recommendations UI ‚Äî 1 –¥–µ–Ω—å

- [ ] –ü–∞—Ä—Å–∏–Ω–≥ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –æ—Ç–≤–µ—Ç–∞—Ö GPT
- [ ] –ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ–¥ –æ—Ç–≤–µ—Ç–æ–º
- [ ] –°—Å—ã–ª–∫–∏ –Ω–∞ `/menu` —Å highlight –Ω—É–∂–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
- [ ] Structured output –æ—Ç GPT (JSON —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏)

### Phase 5: Advanced Features ‚Äî 2-3 –¥–Ω—è

- [ ] RAG —Å –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π
- [ ] –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (–∞–≤—Ç–æ-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞)
- [ ] Rate limiting
- [ ] Analytics (–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –∫–æ–Ω–≤–µ—Ä—Å–∏–∏)
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

---

## Security & Privacy

1. **–ù–µ —Ö—Ä–∞–Ω–∏–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –≤ –ª–æ–≥–∞—Ö OpenAI
2. **–ê–Ω–æ–Ω–∏–º–∏–∑–∏—Ä—É–µ–º** –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤
3. **Rate limiting** –ø—Ä–æ—Ç–∏–≤ —Å–ø–∞–º–∞
4. **–ú–æ–¥–µ—Ä–∞—Ü–∏—è** –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (OpenAI moderation endpoint)
5. **–ß–µ—Ç–∫–∏–π disclaimer:** "Agent –º–æ–∂–µ—Ç –æ—à–∏–±–∞—Ç—å—Å—è, —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç –∂–∏–≤—ã—Ö –±–∞–¥—Ç–µ–Ω–¥–µ—Ä–æ–≤"

---

## Success Metrics

1. **Engagement:** 
   - % –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞–¥–∞–≤—à–∏—Ö > 3 –≤–æ–ø—Ä–æ—Å–∞
   - % –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏—Ö—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (return rate)
   - –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –¥–∏–∞–ª–æ–≥–∞
2. **Conversion:** % –¥–∏–∞–ª–æ–≥–æ–≤ ‚Üí –ø–æ—Å–µ—â–µ–Ω–∏–µ –º–µ–Ω—é
3. **Satisfaction:** –õ–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏ –Ω–∞ –æ—Ç–≤–µ—Ç—ã
4. **Cost:** –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–∞ –¥–∏–∞–ª–æ–≥
5. **Quality:** –†—É—á–Ω–æ–π –∞—É–¥–∏—Ç 100 –¥–∏–∞–ª–æ–≥–æ–≤/–Ω–µ–¥–µ–ª—é
6. **Personalization:** % –¥–∏–∞–ª–æ–≥–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º user context

---

## Risks & Mitigations

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| –í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å API | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | Rate limiting, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| –ù–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤, fallback –Ω–∞ –∂–∏–≤–æ–≥–æ –±–∞–¥—Ç–µ–Ω–¥–µ—Ä–∞ |
| –ó–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | Moderation API, rate limits, ban –ø–æ IP |
| –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏ | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | Disclaimer, –ª–æ–≥–∏ –¥–∏–∞–ª–æ–≥–æ–≤, compliance |

---

## Future Enhancements

1. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:** 
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —á–µ—Ä–µ–∑ Supabase
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–∫—É–ø–∫–∞–º–∏ (—á–µ–∫–∏)
   - ML-–º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
2. **–ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å:** GPT-4 Vision –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ç–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** Telegram bot, WhatsApp Business
4. **Booking:** –ü—Ä—è–º–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —á–∞—Ç
5. **Gamification:** 
   - "–î—É—Ö–æ–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã" (–ø–æ–ø—Ä–æ–±—É–π 5 —Ä–∞–∑–Ω—ã—Ö —Å–∞—Ç–∏–≤)
   - –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ badges
   - –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
6. **Social Features:**
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - "–î—Ä—É–∑—å—è —Ç–∞–∫–∂–µ –≤—ã–±–∏—Ä–∞–ª–∏..."

---

## References

- [OpenAI Chat Completions API](https://platform.openai.com/docs/guides/chat)
- [OpenAI Whisper API](https://platform.openai.com/docs/guides/speech-to-text)
- [Supabase Vector](https://supabase.com/docs/guides/ai/vector-columns)
- [Next.js Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)

---

**Decision:** Approved pending implementation  
**Next Steps:** Start Phase 1 (Core Chat MVP)
