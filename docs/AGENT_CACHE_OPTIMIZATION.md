# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è AI Agent

## –ü—Ä–æ–±–ª–µ–º–∞

–ê–≥–µ–Ω—Ç –¥–µ–ª–∞–ª **–¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î** –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏:
1. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–Ω—é (–¥–ª—è –ø—Ä–æ–º–ø—Ç–∞ GPT)
2. –î–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —á–∞—Ç–µ)

–≠—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–ª–æ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ ~500-1000ms.

## –†–µ—à–µ–Ω–∏–µ

### 1. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–§–∞–π–ª:** `src/app/api/agent/chat/route.ts`

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω TTL –∫—ç—à–∞ —Å 15 –¥–æ **30 –º–∏–Ω—É—Ç**
- ‚úÖ –ö—ç—à–∏—Ä—É—é—Ç—Å—è —Ç–µ–ø–µ—Ä—å **–∏ —Ç–µ–∫—Å—Ç, –∏ —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ** (MenuRow[])
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ –ë–î** –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `HEAD` endpoint –¥–ª—è prefetch –∫—ç—à–∞

```typescript
// –ö—ç—à —Ö—Ä–∞–Ω–∏—Ç –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∏ rows
let menuCache: {
  contextText: string;  // –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞ GPT
  rows: MenuRow[];      // –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  timestamp: number;
} | null = null;
```

### 2. Prefetch –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

**–§–∞–π–ª:** `src/components/OGLabAgent.tsx`

#### –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è prefetch:
1. **–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–≤–æ–¥–µ —Å–∏–º–≤–æ–ª–∞** –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
2. **–ü—Ä–∏ –Ω–∞—á–∞–ª–µ –≥–æ–ª–æ—Å–æ–≤–æ–π –∑–∞–ø–∏—Å–∏**

```typescript
// –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º onChange
if (!cachePrefetched && e.target.value.length === 1) {
  prefetchMenuCache()
}
```

–ü–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–±–∏—Ä–∞–µ—Ç –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –≥–æ–≤–æ—Ä–∏—Ç –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω, –∫—ç—à —É–∂–µ –ø—Ä–æ–≥—Ä–µ—Ç! üî•

### 3. –ù–æ–≤—ã–µ API endpoints

#### `HEAD /api/agent/chat`
–ü—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞ –±–µ–∑ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç headers:
- `X-Cache-Status`: hit/miss
- `X-Items-Count`: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- `X-Cache-Age`: –≤–æ–∑—Ä–∞—Å—Ç –∫—ç—à–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

#### `GET /api/agent/chat`
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∫—ç—à–∞:
```json
{
  "status": "ok",
  "cache": {
    "exists": true,
    "age_seconds": 450,
    "ttl_seconds": 1800,
    "expired": false,
    "items_count": 85
  }
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- üìä **2 –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î** –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- ‚è±Ô∏è ~1000-1500ms –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- üêå –ú–µ–¥–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- üìä **0 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î** (–ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ –≤ –∫—ç—à)
- ‚è±Ô∏è ~500-800ms –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- üöÄ Prefetch –ø—Ä–æ–≥—Ä–µ–≤–∞–µ—Ç –∫—ç—à –∑–∞—Ä–∞–Ω–µ–µ
- üíæ –ö—ç—à –∂–∏–≤—ë—Ç 30 –º–∏–Ω—É—Ç

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫—ç—à–∞:
```bash
curl https://your-domain.com/api/agent/chat
```

–ü—Ä–æ–≥—Ä–µ—Ç—å –∫—ç—à –≤—Ä—É—á–Ω—É—é:
```bash
curl -I https://your-domain.com/api/agent/chat
```

## –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

### –°–µ—Ä–≤–µ—Ä:
```
üîÑ Fetching fresh menu from database
‚úÖ Menu cached: 85 items
üì¶ Using cached menu (age: 120 sec)
```

### –ö–ª–∏–µ–Ω—Ç:
```
üî• Prefetching menu cache...
‚úÖ Menu cache prefetched: hit (85 items)
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ TTL** –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ - 30 –º–∏–Ω—É—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** - prefetch –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–≤–æ–¥–µ
3. **–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–µ–Ω—é** –ø–æ–¥–æ–∂–¥–∏—Ç–µ –¥–æ 30 –º–∏–Ω—É—Ç –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–í–æ–∑–º–æ–∂–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- [ ] Redis –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∫—ç—à–∞ (–¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤)
- [ ] Webhook –æ—Ç Supabase –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞
- [ ] Streaming –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç GPT (server-sent events)
- [ ] Deduplicate –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø–∞–º–∏—Ç)
