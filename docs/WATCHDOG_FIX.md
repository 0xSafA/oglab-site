# Исправление проблемы с постоянными перезагрузками меню

## Проблема
Watchdog в компоненте `AutoRefresh` был слишком агрессивным и вызывал постоянные перезагрузки страницы каждую секунду, что прерывало анимацию Pacman и показывало заставку на ТВ.

## Причина
Параметры watchdog были слишком строгими:
- `HEARTBEAT_TIMEOUT_MS = 15_000` (15 секунд)
- `CHECK_EVERY_MS = 5_000` (5 секунд)
- `MAX_CONSECUTIVE_STALLS = 2`

На ТВ и медленных устройствах это приводило к ложным срабатываниям.

## Решение

### 1. Умная автоматическая детекция устройств
Система автоматически определяет тип устройства и его производительность:

**Детекция ТВ:**
- User-Agent (WebOS, Tizen, SmartTV, BRAVIA, NetCast)
- Характеристики экрана (≥1920x1080 без тач-скрина)

**Детекция медленных устройств:**
- Отсутствие современных API (requestAnimationFrame, performance)
- Низкое соотношение пикселей (devicePixelRatio < 1.5 на больших экранах)
- Мало памяти (deviceMemory ≤ 2GB)

### 2. Адаптивные параметры по типу устройства

**ТВ экраны:**
- timeout=120с, check=30с, maxStalls=6
- **Автоматически отключается** для слабых ТВ
- Включается только для производительных ТВ (4+ ядра CPU)

**Медленные устройства:**
- timeout=60с, check=20с, maxStalls=4
- Мягкие параметры, но watchdog активен

**Обычные устройства:**
- timeout=30с, check=10с, maxStalls=3
- Стандартная защита

### 3. Улучшенная детекция зависания
- Проверка состояния загрузки страницы
- Проверка активных анимаций
- Сброс счетчика при восстановлении
- Учет скрытых вкладок

### 4. Полностью автоматическое решение
- **Никаких ручных настроек не требуется!**
- Система сама определяет оптимальные параметры
- Переменная окружения `NEXT_PUBLIC_DISABLE_WATCHDOG=true` для принудительного отключения

## Использование

### Автоматическая работа
Система работает полностью автоматически:
- ТВ экраны автоматически определяются и получают оптимальные настройки
- Медленные устройства получают мягкие параметры
- Обычные устройства работают со стандартной защитой

### Принудительное отключение (если нужно)
Только для особых случаев - установите переменную окружения:
```bash
NEXT_PUBLIC_DISABLE_WATCHDOG=true
```

## Результат
- ✅ Пакман может нормально анимироваться без прерываний
- ✅ Нет постоянных перезагрузок на ТВ
- ✅ Watchdog все еще защищает от реальных зависаний
- ✅ Гибкая настройка для разных устройств

## Файлы изменены
- `src/components/AutoRefresh.tsx` - основные исправления watchdog
